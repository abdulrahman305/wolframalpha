Add test for async functionality and fixed issue with implementation.